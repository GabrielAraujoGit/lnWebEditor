<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Validador LN Web - Markdown</title>
<link href="https://cdn.jsdelivr.net/npm/prismjs@1.30.0/themes/prism-tomorrow.css" rel="stylesheet" />
<style>
    body { font-family: Arial, sans-serif; padding: 30px; background: #f4f4f4; }
    h1 { color: #333; }
    textarea { width: 100%; height: 300px; font-family: monospace; font-size: 14px; padding: 10px; border: 1px solid #ccc; border-radius: 5px; resize: vertical; }
    button { margin-top: 10px; padding: 10px 20px; font-size: 16px; border: none; border-radius: 5px; background: #0078D7; color: white; cursor: pointer; }
    button:disabled { background: #999; cursor: not-allowed; }
    #loading { display: none; margin-left: 10px; font-weight: bold; color: #0078D7; }
    #result { margin-top: 20px; padding: 15px; background: #fff; border-radius: 5px; border: 1px solid #ccc; max-height: 500px; overflow-y: auto; }
    pre { border-radius: 5px; padding: 10px; }
</style>
</head>
<body>
<h1>Validador de Scripts LN/Baan</h1>
<textarea id="script" placeholder="Cole seu script LN aqui..."></textarea><br>
<button id="analyzeBtn">Analisar</button>
<span id="loading">Carregando...</span>

<h2>Resultado:</h2>
<div id="result">Ainda não analisado.</div>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.30.0/prism.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.30.0/components/prism-bash.min.js"></script>
<script>
const btn = document.getElementById('analyzeBtn');
const loading = document.getElementById('loading');
const resultEl = document.getElementById('result');
const scriptEl = document.getElementById('script');

async function analyze() {
    const script = scriptEl.value.trim();
    if (!script) { alert("Cole um script antes de analisar."); return; }

    btn.disabled = true;
    loading.style.display = 'inline';
    resultEl.innerHTML = "";

    try {
        const response = await fetch('http://127.0.0.1:8000/analyze', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ script })
        });
        if (!response.ok) throw new Error(`Erro na requisição: ${response.status}`);
        const data = await response.json();

        // Parse Markdown
        const html = marked.parse(data.analysis);
        resultEl.innerHTML = html;

        // Highlight de código
        Prism.highlightAll();
    } catch (err) {
        resultEl.innerHTML = `<pre>Ocorreu um erro: ${err.message}</pre>`;
    } finally {
        btn.disabled = false;
        loading.style.display = 'none';
    }
}

btn.addEventListener('click', analyze);
scriptEl.addEventListener('keydown', function(e){ if (e.ctrlKey && e.key === 'Enter') analyze(); });
</script>
</body>
</html>
